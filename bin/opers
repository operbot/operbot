#!/usr/bin/env python3
# This file is placed in the Public Domain.
# pylint: disable=E1101,E0611,C0115,C0116,C0413,C0411,W0406


"program your own commands"


import os
import readline
import signal
import sys
import termios
import time


sys.path.insert(0, os.getcwd())


from op.wdr import Wd
from op.obj import keys, printable, update
from opr.clt import Client
from opr.evt import Event, docmd
from opr.prs import parse
from opr.scn import scan
from opr.utl import wait
from oper import cmd, irc, rss
from oper.irc import Config, IRC
from oper.rss import Fetcher
from oper.run import Cfg


Config.nick = "operbot"
Config.channel = "#operbot"
Config.realname = "program your own commands"
Config.username = "operbot"
Wd.workdir = os.path.expanduser("~/.operbot")


scan(cmd)
scan(irc)
scan(rss)


def hup(_sig, _frame):
    print("signal 15 called")
    sys.stdout.flush()


def isopt(ostr):
    for opt in ostr:
        if opt in Cfg.opts:
            return True
    return False


def wrap(func):
    fds = sys.stdin.fileno()
    gotterm = True
    try:
        old = termios.tcgetattr(fds)
    except termios.error:
        gotterm = False
    readline.redisplay()
    try:
        func()
    except (EOFError, KeyboardInterrupt):
        print("")
    finally:
        if gotterm:
            termios.tcsetattr(fds, termios.TCSADRAIN, old)


def main():
    signal.signal(signal.SIGHUP, hup)
    bot = IRC()
    bot.start()
    fetcher = Fetcher()
    fetcher.start()
    wait()
        

wrap(main)
